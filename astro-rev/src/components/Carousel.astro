---
import CarouselOverlay from "./CarouselOverlay.astro"
import type { ImageMetadata } from 'astro';

interface SlideData {
  image: string | ImageMetadata;
  topComment?: string;
  bottomComment?: string;
}

interface Props {
  images?: (string | ImageMetadata)[];
  slides?: SlideData[];
  showCaptions?: boolean;
  captions?: string[];
  class?: string;
}

const { images, slides, showCaptions = false, captions = [], class: className = '' } = Astro.props;

// Helper function to get image src from either string or ImageMetadata
const getImageSrc = (image: string | ImageMetadata): string => {
  return typeof image === 'string' ? image : image.src;
};

// Use slides if provided, otherwise create simple slides from images array
const slideData = slides || (images || []).map((image, index) => ({
  image,
  topComment: undefined,
  bottomComment: undefined
}));
---

<div class={`carousel ${className}`}>
    <div class="carousel-track" id="carousel-track">
      {slideData.map((slide, index) => {
        const imageSrc = getImageSrc(slide.image);
        return (
          <div class="slide">
            <img src={index === 0 ? imageSrc : undefined} data-src={imageSrc} alt={captions[index] || `Image ${index + 1}`}>
            {slide.topComment && slide.bottomComment ? (
              <CarouselOverlay width="30%" topComment={slide.topComment} bottomComment={slide.bottomComment} />
            ) : showCaptions && captions[index] && (
              <div class="caption">
                {captions[index]}
              </div>
            )}
          </div>
        );
      })}
    </div>
    <button class="prev h-16 hover:bg-primary hover:bg-opacity-50" id="prev">&lt;</button>
    <button class="next h-16 hover:bg-primary hover:bg-opacity-50" id="next">&gt;</button>
  </div>
  

<style>
    .carousel {
  position: relative;
  width: 100%;
  overflow: hidden;
  margin: auto;
}

.carousel-track {
  display: flex;
  transition: transform 0.5s ease-in-out;
}

.slide {
  min-width: 100%;
  position: relative;
}

img {
  width: 100%;
  height: auto;
  display: block;
}

.overlay {
  position: absolute;
  display: flex-column;
  left:100px;
  top: 50px;
  bottom: 50px;
  width: 30%;
  background: rgba(0, 0, 0, 0.5);
  color: white;
  text-align: center;
  padding: 10px;
}

.top-overlay {
  position: relative;
  border-bottom: 4px solid white;
  
  color: white;
  text-align: center;
  padding: 10px;
}

button {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0, 0, 0, 0.7);
  color: white;
  border: none;
  padding: 10px;
  cursor: pointer;
}

.prev { left: 10px; }
.next { right: 10px; }

.caption {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 8px 20px;
  border-radius: 4px;
  font-size: 1rem;
  font-weight: 600;
  text-align: center;
}

</style>
<script src="../scripts/carousel.ts">
</script>