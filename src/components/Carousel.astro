---
import CarouselOverlay from "./CarouselOverlay.astro"
import type { ImageMetadata } from 'astro';

interface SlideData {
  image: string | ImageMetadata;
  topComment?: string;
  bottomComment?: string;
}

interface Props {
  images?: (string | ImageMetadata)[];
  slides?: SlideData[];
  showCaptions?: boolean;
  captions?: string[];
  class?: string;
}

const { images, slides, showCaptions = false, captions = [], class: className = '' } = Astro.props;

// Helper function to get image src from either string or ImageMetadata
const getImageSrc = (image: string | ImageMetadata): string => {
  return typeof image === 'string' ? image : image.src;
};

// Use slides if provided, otherwise create simple slides from images array
const slideData = slides || (images || []).map((image, index) => ({
  image,
  topComment: undefined,
  bottomComment: undefined
}));
---

<div class={`carousel ${className}`}>
    <div class="carousel-track" id="carousel-track">
      {slideData.map((slide, index) => {
        const imageSrc = getImageSrc(slide.image);
        return (
          <div class="slide">
            <img src={index === 0 ? imageSrc : undefined} data-src={imageSrc} alt={captions[index] || `Image ${index + 1}`}>
            {slide.topComment && slide.bottomComment ? (
              <CarouselOverlay topComment={slide.topComment} bottomComment={slide.bottomComment} />
            ) : showCaptions && captions[index] && (
              <div class="caption">
                {captions[index]}
              </div>
            )}
          </div>
        );
      })}
    </div>
    <button class="prev h-12 sm:h-14 lg:h-16 px-2 sm:px-3 lg:px-4 hover:bg-primary hover:bg-opacity-50" id="prev">&lt;</button>
    <button class="next h-12 sm:h-14 lg:h-16 px-2 sm:px-3 lg:px-4 hover:bg-primary hover:bg-opacity-50" id="next">&gt;</button>
  </div>
  

<style>
    .carousel {
  position: relative;
  width: 100%;
  overflow: hidden;
  margin: auto;
  max-height: 400px;
}

@media (min-width: 640px) {
  .carousel {
    max-height: 500px;
  }
}

@media (min-width: 768px) {
  .carousel {
    max-height: 600px;
  }
}

@media (min-width: 1024px) {
  .carousel {
    max-height: none;
  }
}

.carousel-track {
  display: flex;
  transition: transform 0.5s ease-in-out;
}

.slide {
  min-width: 100%;
  position: relative;
  height: 400px;
}

@media (min-width: 640px) {
  .slide {
    height: 500px;
  }
}

@media (min-width: 768px) {
  .slide {
    height: 600px;
  }
}

@media (min-width: 1024px) {
  .slide {
    height: auto;
  }
}

img {
  width: 100%;
  height: 100%;
  display: block;
  object-fit: cover;
}

@media (min-width: 1024px) {
  img {
    height: auto;
    object-fit: initial;
  }
}

.overlay {
  position: absolute;
  display: flex-column;
  left:100px;
  top: 50px;
  bottom: 50px;
  width: 30%;
  background: rgba(0, 0, 0, 0.5);
  color: white;
  text-align: center;
  padding: 10px;
}

.top-overlay {
  position: relative;
  border-bottom: 4px solid white;
  
  color: white;
  text-align: center;
  padding: 10px;
}

button {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0, 0, 0, 0.7);
  color: white;
  border: none;
  padding: 10px;
  cursor: pointer;
}

.prev { left: 10px; }
.next { right: 10px; }

.caption {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 6px 12px;
  border-radius: 4px;
  font-size: 0.875rem;
  font-weight: 600;
  text-align: center;
}

@media (min-width: 640px) {
  .caption {
    bottom: 15px;
    padding: 8px 16px;
    font-size: 0.95rem;
  }
}

@media (min-width: 1024px) {
  .caption {
    bottom: 20px;
    padding: 8px 20px;
    font-size: 1rem;
  }
}

</style>
<script src="../scripts/carousel.ts">
</script>